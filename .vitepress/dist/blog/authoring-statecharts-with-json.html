<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JSON is not the best format for authoring statecharts | StateML</title>
    <meta name="description" content="A language for authoring state machines.">
    <link rel="stylesheet" href="/assets/style.97ac7840.css">
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="preload" as="font" href="/fira-code-variable.ttf" crossorigin="anonymous">
    <meta name="keywords" content="SML, StateML, State Machine Language, state machines, finite state machines, FSM, statecharts">
    <meta name="twitter:title" content="JSON is not the best format for authoring statecharts | StateML">
    <meta property="og:title" content="JSON is not the best format for authoring statecharts | StateML">
  </head>
  <body>
    <div id="app"><div class="flex flex-col justify-center"><nav class="justify-between flex items-center flex-col md:flex-row mb-10"><a href="/" class="mb-4 md:mb-0"><svg viewBox="0 0 304 100" xmlns="http://www.w3.org/2000/svg" class="h-16 md:h-10 fill-current stroke-current"><path d="M111.296 57.2675C111.296 59.5465 110.696 61.5605 109.494 63.3095C108.311 65.0585 106.606 66.4277 104.38 67.417C102.154 68.4063 99.4775 68.901 96.3505 68.901C92.8878 68.901 89.9816 68.3975 87.632 67.3905C85.3 66.3658 83.3655 65.1027 81.8285 63.601L86.2275 58.725C87.5878 59.9087 89.0895 60.8273 90.7325 61.481C92.3755 62.117 94.1775 62.435 96.1385 62.435C97.9581 62.435 99.4333 62.0463 100.564 61.269C101.695 60.474 102.26 59.361 102.26 57.93C102.26 56.5873 101.783 55.5362 100.829 54.7765C99.8926 54.0168 98.1436 53.2483 95.582 52.471C91.289 51.1637 88.2326 49.6267 86.413 47.86C84.611 46.0757 83.71 43.7878 83.71 40.9965C83.71 38.7528 84.3283 36.836 85.565 35.246C86.8193 33.656 88.4976 32.4458 90.6 31.6155C92.7023 30.7675 95.0166 30.3435 97.543 30.3435C100.387 30.3435 102.896 30.7587 105.069 31.589C107.242 32.4017 109.123 33.5677 110.713 35.087L106.606 39.804C105.369 38.7617 104.035 37.9932 102.604 37.4985C101.173 36.9862 99.716 36.73 98.232 36.73C96.5713 36.73 95.2375 37.0392 94.2305 37.6575C93.2235 38.2582 92.72 39.1503 92.72 40.334C92.72 41.1113 92.9408 41.765 93.3825 42.295C93.8241 42.825 94.5926 43.3285 95.688 43.8055C96.7833 44.2648 98.3026 44.8037 100.246 45.422C102.56 46.1287 104.539 46.9767 106.182 47.966C107.843 48.9377 109.106 50.1655 109.971 51.6495C110.855 53.1335 111.296 55.0062 111.296 57.2675ZM137.776 66.357C136.68 67.0637 135.355 67.6643 133.801 68.159C132.246 68.6537 130.497 68.901 128.554 68.901C124.879 68.901 122.15 67.9647 120.365 66.092C118.581 64.2017 117.689 61.64 117.689 58.407V45.634H111.779V39.857H117.689V33.762L126.063 32.755V39.857H135.126L134.304 45.634H126.063V58.407C126.063 59.8027 126.381 60.8008 127.017 61.4015C127.653 62.0022 128.669 62.3025 130.064 62.3025C131.054 62.3025 131.955 62.1877 132.767 61.958C133.598 61.7107 134.34 61.4015 134.993 61.0305L137.776 66.357ZM163.672 59.891C163.672 60.951 163.813 61.7195 164.096 62.1965C164.396 62.6735 164.873 63.0357 165.527 63.283L163.805 68.795C162.144 68.636 160.739 68.2738 159.591 67.7085C158.46 67.1255 157.568 66.251 156.915 65.085C155.837 66.3747 154.459 67.3375 152.781 67.9735C151.102 68.5918 149.389 68.901 147.64 68.901C144.742 68.901 142.428 68.0795 140.697 66.4365C138.983 64.7758 138.126 62.647 138.126 60.05C138.126 56.9937 139.319 54.6352 141.704 52.9745C144.106 51.3138 147.481 50.4835 151.827 50.4835H155.616V49.4235C155.616 46.5438 153.761 45.104 150.051 45.104C149.15 45.104 147.993 45.2365 146.58 45.5015C145.166 45.7488 143.753 46.111 142.34 46.588L140.405 41.023C142.225 40.334 144.115 39.8128 146.076 39.4595C148.055 39.1062 149.821 38.9295 151.376 38.9295C155.563 38.9295 158.655 39.7863 160.651 41.5C162.665 43.196 163.672 45.6517 163.672 48.867V59.891ZM150.528 62.912C151.429 62.912 152.374 62.647 153.364 62.117C154.353 61.5693 155.104 60.8008 155.616 59.8115V55.2535H153.549C151.217 55.2535 149.503 55.6157 148.408 56.34C147.313 57.0467 146.765 58.089 146.765 59.467C146.765 60.5447 147.092 61.3927 147.746 62.011C148.417 62.6117 149.344 62.912 150.528 62.912ZM192.854 66.357C191.759 67.0637 190.434 67.6643 188.879 68.159C187.325 68.6537 185.576 68.901 183.632 68.901C179.958 68.901 177.228 67.9647 175.444 66.092C173.66 64.2017 172.767 61.64 172.767 58.407V45.634H166.858V39.857H172.767V33.762L181.141 32.755V39.857H190.204L189.383 45.634H181.141V58.407C181.141 59.8027 181.459 60.8008 182.095 61.4015C182.731 62.0022 183.747 62.3025 185.143 62.3025C186.132 62.3025 187.033 62.1877 187.846 61.958C188.676 61.7107 189.418 61.4015 190.072 61.0305L192.854 66.357ZM202.321 56.3665C202.603 58.6632 203.354 60.315 204.573 61.322C205.792 62.3113 207.294 62.806 209.078 62.806C210.368 62.806 211.613 62.594 212.815 62.17C214.016 61.746 215.173 61.1807 216.286 60.474L219.652 65.032C218.327 66.1627 216.719 67.0902 214.829 67.8145C212.956 68.5388 210.818 68.901 208.416 68.901C205.2 68.901 202.506 68.265 200.333 66.993C198.16 65.7033 196.526 63.9367 195.431 61.693C194.335 59.4493 193.788 56.87 193.788 53.955C193.788 51.1813 194.318 48.6638 195.378 46.4025C196.438 44.1235 197.983 42.3127 200.015 40.97C202.064 39.6097 204.564 38.9295 207.515 38.9295C210.2 38.9295 212.523 39.5037 214.484 40.652C216.463 41.8003 217.991 43.4522 219.069 45.6075C220.164 47.7628 220.712 50.351 220.712 53.372C220.712 53.849 220.694 54.3613 220.659 54.909C220.641 55.4567 220.606 55.9425 220.553 56.3665H202.321ZM207.515 44.5475C206.013 44.5475 204.803 45.0863 203.884 46.164C202.965 47.2417 202.409 48.9642 202.215 51.3315H212.55C212.532 49.2822 212.134 47.6392 211.357 46.4025C210.58 45.1658 209.299 44.5475 207.515 44.5475ZM252.994 31.271L255.061 68H247.482L247.032 52.2855C246.979 50.3422 246.961 48.655 246.979 47.224C247.014 45.793 247.076 44.4238 247.164 43.1165C247.253 41.7915 247.359 40.3075 247.482 38.6645L243.348 61.746H236.776L232.324 38.6645C232.466 40.2015 232.581 41.6502 232.669 43.0105C232.757 44.3532 232.81 45.7665 232.828 47.2505C232.863 48.7345 232.863 50.457 232.828 52.418L232.563 68H225.116L227.183 31.271H236.114L240.195 55.015L244.064 31.271H252.994ZM261.957 68V31.271H270.649V61.1365H286.576L285.675 68H261.957Z"></path><rect x="71" y="5" width="228" height="90" rx="18" stroke-width="10" fill="none"></rect><path d="M64 48.3238C66.6667 49.8634 66.6667 53.7124 64 55.252L44.1818 66.694C41.5152 68.2336 38.1818 66.3091 38.1818 63.2299V40.3459C38.1818 37.2667 41.5152 35.3422 44.1818 36.8818L64 48.3238Z"></path><path d="M10.6061 19.9697C10.6061 45.4243 16.4394 51.7879 42.4242 51.7879" fill="none" stroke-width="8"></path><circle cx="10.6061" cy="17.8485" r="10.6061"></circle></svg></a><div class="flex flex-wrap justify-center gap-6 md:justify-end"><a href="#">Learn</a><a href="#">Playground</a><a href="#">Spec</a><a href="/blog" class="font-bold">Blog</a><a href="https://github.com/StateML">Github</a><a href="https://twitter.com/stateml_org">Twitter</a></div></nav><main class="max-w-3xl mx-auto px-4 mb-20 sm:px-6 xl:max-w-5xl xl:px-0"><article class="prose"><header class="mb-8"><dl><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500"><time datetime="2021-10-18T12:00:00.000Z">October 18, 2021</time></dd></dl><h1>JSON is not the best format for authoring statecharts</h1><dl class="flex gap-2 text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900">Chris Shank</dd> | <dt class="sr-only">Twitter</dt><dd><a href="https://twitter.com/@chrisshank23" target="_blank" rel="noopnener noreferrer" class="link">@chrisshank23</a></dd></dl></header><div style="position:relative;"><div><blockquote><p>Is JSON really the best we can do as a DSL for building statecharts? <a href="https://twitter.com/mpocock1/status/1439853560150298624" target="_blank" rel="noopener noreferrer">source</a></p></blockquote><p>My take on this question is that JSON <em>might</em> be the best format to interop statecharts between computers like interpreters and tooling, but it&#39;s a suboptimal format for authoring statecharts. Let&#39;s try to dig into why!</p><p>(Just to be clear the follow is less a critque of <code>xstate</code> and more an examination of how we can make authoring statecharts better!)</p><p>In a statechart there are numerous cases where one or more entities can exist. For example there can be one or more actions defined on a <code>entry</code>/<code>exit</code>/transition, there could be one or more targets on a transtion, there could one or more transitions per event, ect. So if you are designing a JSON API for statecharts, you come to a conondrum where you either make everything plural by default or you provide shorthands so each of these cases can be singular or plural. The former keeps the API significantly smaller and makes the implementation easier, but comes at the cost that the developer must <a href="https://www.swyx.io/preemptive-pluralization/" target="_blank" rel="noopener noreferrer">pluralize</a> everything. In JSON this means that these things must be wrapped in a array even if there is only one action. This comes at the cost of burdening the developer with an API that is much less concise, especially when singular instances are the most common. One upside is that refactoring an existing statechart becomes a little easier since, for example, there is no need to wrap a single action in an array to add another one as shown below.</p><div class="language-diff"><pre><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> entry: [“someAction”],
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> entry: [“someAction”, “someOtherAction”]
</span></span></code></pre></div><p><code>xstate</code> chose to go down the later; add shorthands for all of these different cases. While I think this was <em>probably</em> the better path of the two it does come with its own dowsides. Mainly the surface layer of the API becomes significantly larger and the implementation becomes more complex (to a certain degree). At least the developer can type less characters up front, but the cost happens when you need to refactor from a singular shorthand as shown below:</p><div class="language-diff"><pre><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> entry: “someAction”,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> entry: [“someAction”, “someOtherAction”]
</span></span></code></pre></div><p>This may seem like an unecessary critisism, but if I&#39;m being honest this type of consistent micro-decisions really adds up and takes way from what we are trying to do: model with statecharts. It affects the learning curve since there is so much more syntax to learn (on top of the underlying concepts of statecharts). It affects cognitive load and descision fatigue because we need to consitently think about whether you might need to wrap something in an array in the future.</p><p>Similarly this disonnance reveals it self since objects in JSON are key-value pairs. State nodes and transtions are objects, but most of the time they have a single attribute (e.g. an event just has a <code>target</code>). So in these cases we end up in the same dilemma as above; should we allow a shorthand for these cases? Like above I think the shorthad makes the most sense, but the downsides still exist. In the example below, look at all of the refactoring you have to do to add one action to a transtion!</p><div class="language-diff"><pre><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> on : { SOME_EVENT: &#39;someTarget&#39; },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> on : { SOME_EVENT: { target: &#39;someTarget&#39;, actions: &#39;someAction&#39; },
</span></span></code></pre></div><p>Brackets, quotes, and colons, are syntax that gets in the way of what we are trying to express. They add significantly more lines, indents, and characters to our model and I suspect that a well-defined statechart DSL could reduce these quantities by up to 30-60%. Furthermore this extra syntax starts to weaken the 1:1 mapping between our code and the visual state chart we are trying to code.</p><p>If we want to make statecharts easier to write/read/refactor and if we want to lower the learning curve, and the cognitive load developers currently experience then I suspect that figuring out a new language to express ststecharts might be a good starting point to address all of these problems!</p></div></div><footer><div><h2>Next Article</h2><a href="/blog/the-symbolic-boundry-of-statecharts.html">The symbolic boundary of statecharts; hidden between the visual formalism and executable schematic</a></div><div><h2 class="text-xs tracking-wide uppercase text-gray-500">Previous Article</h2><a href="/blog/the-initial-state.html">The Initial State: An Introduction</a></div><a class="link" href="/">← Back to the blog</a></footer></article></main><div class="text-center">Copyright © 2021 StateML.</div></div></div>
    
    
    
  </body>
</html>